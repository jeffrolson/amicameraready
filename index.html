<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Am I Camera Ready?....</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Panzoom library for zoom/pan functionality -->
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <!-- Google Analytics - Global Site Tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T0MQT54L6P"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-T0MQT54L6P');
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f3f4f6;
            overflow: hidden;
        }
        #video-container {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            cursor: grab;
            transform: scaleX(-1);
        }
        #video-feed {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transform-origin: 50% 50%;
        }
        #video-container.is-panning {
            cursor: grabbing;
        }
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            z-index: 50;
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            font-size: 1.125rem;
            font-weight: 500;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translate(-50%, -50%) scaleX(-1);
        }
        .side-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
            background-color: rgba(17, 24, 39, 0.5);
            color: rgba(243, 244, 246, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.7);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 0.1em;
            backdrop-filter: blur(5px);
            pointer-events: none;
        }
        .left-indicator { left: 1.5rem; }
        .right-indicator { right: 1.5rem; }
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: transparent;
            cursor: pointer;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #4b5563;
            border-radius: 2px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -6px;
            background-color: #3b82f6;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            border: 2px solid #fff;
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 4px;
            background: #4b5563;
            border-radius: 2px;
        }
        input[type=range]::-moz-range-thumb {
            background-color: #3b82f6;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            border: 2px solid #fff;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video-feed" autoplay playsinline muted></video>
    </div>

    <header id="main-header" class="fixed top-0 left-0 w-full z-30 p-3 sm:p-4 bg-gray-900/75 backdrop-blur-md flex items-center justify-between shadow-lg">
        <div class="flex items-center gap-3">
            <img src="https://i.imgur.com/MtzMbYV.png" alt="Am I Camera Ready Logo" class="h-8 sm:h-10 w-auto">
            <h1 class="text-lg sm:text-xl font-bold text-white hidden md:block">Am I Camera Ready?</h1>
        </div>
        <div id="subscription-form-container">
            <form id="email-form" class="flex items-center gap-2">
                <input type="email" id="email-input" placeholder="Enter email for updates" required class="w-36 sm:w-64 bg-gray-800/50 border border-gray-600 text-white text-xs sm:text-sm rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none placeholder-gray400">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold text-xs sm:text-sm py-2 px-3 sm:px-4 rounded-md transition-colors">Stay Updated</button>
            </form>
        </div>
    </header>

    <div class="side-indicator left-indicator">LEFT</div>
    <div class="side-indicator right-indicator">RIGHT</div>

    <div id="controls-container" class="fixed bottom-4 right-4 z-30 flex items-center gap-4 bg-gray-900/75 backdrop-blur-md p-3 rounded-lg shadow-lg">
        <div id="camera-controls-container" class="hidden items-center gap-2">
            <label for="camera-select" class="font-medium text-xs sm:text-sm text-gray-200">CAMERA:</label>
            <select id="camera-select" class="bg-gray-700 text-gray-100 border-none rounded-md px-2 py-1 text-xs sm:text-sm cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
        </div>
        <div id="zoom-container" class="flex items-center gap-2 w-32">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line></svg>
            <input type="range" id="zoom-slider" min="1" max="5" step="0.1" value="1">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line><line x1="11" y1="8" x2="11" y2="14"></line></svg>
        </div>
    </div>
    <div id="message-container"></div>

    <script>
        // --- DOM Element Selection ---
        const videoContainer = document.getElementById('video-container');
        const videoElement = document.getElementById('video-feed');
        const cameraSelect = document.getElementById('camera-select');
        const cameraControlsContainer = document.getElementById('camera-controls-container');
        const messageContainer = document.getElementById('message-container');
        const emailForm = document.getElementById('email-form');
        const zoomSlider = document.getElementById('zoom-slider');

        // --- State Variables ---
        let currentStream;
        let panzoomInstance;

        // --- Core Functions ---

        function showMessage(text) {
            messageContainer.innerHTML = `<div class="error-message">${text}</div>`;
        }

        function stopCurrentStream() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
        }

        async function getCameraStream(deviceId) {
            stopCurrentStream();
            const constraints = {
                video: { deviceId: deviceId ? { exact: deviceId } : undefined, width: { ideal: 1280 }, height: { ideal: 720 }, frameRate: { ideal: 30 } },
                audio: false
            };
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                currentStream = stream;
                videoElement.srcObject = stream;
                videoElement.onloadedmetadata = () => {
                    if (!panzoomInstance) initializePanzoom();
                    else panzoomInstance.reset();
                };
            } catch (err) {
                handleGetUserMediaError(err);
            }
        }

        async function setupCameraSelector() {
            try {
                const tempStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                tempStream.getTracks().forEach(track => track.stop());
                
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                cameraSelect.innerHTML = '';

                if (videoDevices.length > 0) {
                    if (videoDevices.length > 1) {
                        videoDevices.forEach((device, index) => {
                            const option = document.createElement('option');
                            option.value = device.deviceId;
                            option.text = device.label || `Camera ${index + 1}`;
                            cameraSelect.appendChild(option);
                        });
                        cameraControlsContainer.style.display = 'flex';
                    }
                    cameraSelect.addEventListener('change', () => {
                        getCameraStream(cameraSelect.value);
                    });
                    getCameraStream(videoDevices[0].deviceId);
                } else {
                     showMessage("No cameras found. Please connect a camera and refresh.");
                }
            } catch (err) {
                handleGetUserMediaError(err);
            }
        }

        function handleGetUserMediaError(err) {
            let message = "An unexpected error occurred.";
            if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                message = "Camera access denied. Please enable permissions and refresh.";
            } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                message = "No cameras found. Please connect a camera and refresh.";
            } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
                message = "Your camera might be in use by another app. Please close it and try again.";
            }
            showMessage(message);
        }

        function initializePanzoom() {
            panzoomInstance = Panzoom(videoElement, {
                maxScale: 5,
                minScale: 1,
                contain: 'outside',
                canvas: true,
                step: 0.1,
                // --- KEY FIX: Disable the library's default panning to implement our own. ---
                disablePan: true
            });

            videoElement.addEventListener('panzoomzoom', (event) => {
                zoomSlider.value = event.detail.scale;
            });

            videoContainer.addEventListener('wheel', (event) => {
                if (!event.ctrlKey) {
                    panzoomInstance.zoomWithWheel(event);
                }
            });

            // --- KEY FIX: A clean, custom drag handler that works because disablePan is true. ---
            let isPanning = false;

            const handleDrag = (e) => {
                // Only pan with the primary mouse button and only when zoomed in
                if (e.button !== 0 || panzoomInstance.getScale() <= 1) return;
                e.preventDefault();
                e.stopPropagation();
                isPanning = true;
                videoContainer.classList.add('is-panning');

                const move = (moveEvent) => {
                    if (!isPanning) return;
                    // Invert the horizontal movement to match the mirrored view
                    panzoomInstance.pan(-moveEvent.movementX, moveEvent.movementY, {
                        relative: true
                    });
                };

                const up = () => {
                    isPanning = false;
                    videoContainer.classList.remove('is-panning');
                    document.removeEventListener('mousemove', move);
                    document.removeEventListener('mouseup', up);
                };

                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', up);
            };
            
            // --- KEY FIX: Attach the listener to the videoElement, not the container ---
            videoElement.addEventListener('mousedown', handleDrag);
            
            // Touch support
            let lastTouchX, lastTouchY;
            videoElement.addEventListener('touchstart', (e) => {
                 if (e.touches.length === 1 && panzoomInstance.getScale() > 1) {
                    isPanning = true;
                    lastTouchX = e.touches[0].clientX;
                    lastTouchY = e.touches[0].clientY;
                    videoContainer.classList.add('is-panning');
                 }
            });

            videoElement.addEventListener('touchmove', (e) => {
                if (!isPanning || e.touches.length !== 1) return;
                e.preventDefault();
                const touch = e.touches[0];
                const dx = touch.clientX - lastTouchX;
                const dy = touch.clientY - lastTouchY;
                // Invert horizontal pan for touch
                panzoomInstance.pan(-dx, dy, { relative: true });
                lastTouchX = touch.clientX;
                lastTouchY = touch.clientY;
            });
            
            const endTouch = () => {
                isPanning = false;
                videoContainer.classList.remove('is-panning');
            };
            
            videoElement.addEventListener('touchend', endTouch);
            videoElement.addEventListener('touchcancel', endTouch);
        }

        // --- Event Listeners ---
        emailForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const email = document.getElementById('email-input').value;
            if (email) {
                console.log(`Email submitted: ${email}`);
                document.getElementById('subscription-form-container').innerHTML = `<div class="text-white font-medium text-sm sm:text-base text-center p-2">Thank you!</div>`;
            }
        });

        zoomSlider.addEventListener('input', (event) => {
            if (panzoomInstance) {
                const rect = videoContainer.getBoundingClientRect();
                panzoomInstance.zoom(event.target.value, { 
                    animate: false,
                    focal: { x: rect.width / 2, y: rect.height / 2 }
                });
            }
        });

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            setupCameraSelector();
        } else {
            showMessage("Your browser does not support camera access. Please use a modern browser.");
        }
    </script>
</body>
</html>
